<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Evolution API â€“ GLOBAL WebSocket Inspector</title>
  <style>
    body {
      font-family: system-ui;
      padding: 20px;
    }

    input,
    button,
    select {
      padding: 6px;
      margin: 4px;
    }

    #log {
      border: 1px solid #ccc;
      height: 520px;
      overflow: auto;
      white-space: pre-wrap;
      padding: 8px;
      background: #fafafa;
    }
  </style>
</head>

<body>

  <h2>Evolution API â€“ GLOBAL WebSocket Inspector</h2>

  <input id="base" value="https://eva.hero.delivery" size="40"><br>
  <input id="key" placeholder="API Key (for instance list only)" size="40"><br>

  <button onclick="loadInstances()">Load Instances</button>
  <button onclick="connectGlobal()">Connect GLOBAL WebSocket</button>

  <br><br>
  <select id="instances" size="6" style="width:600px"></select>

  <h3>Log</h3>
  <div id="log"></div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    let socket;
    const logEl = document.getElementById('log');
    const instancesEl = document.getElementById('instances');

    function log(msg) {
      logEl.textContent =
        `[${new Date().toISOString()}] ${msg}\n` + logEl.textContent;
      console.log(msg);
    }

    /* ===============================
       LOAD INSTANCES (VISIBILITY ONLY)
       =============================== */
    async function loadInstances() {
      const base = document.getElementById('base').value.replace(/\/$/, '');
      const key = document.getElementById('key').value.trim();

      if (!key) {
        log('âš  API key required to fetch instances');
        return;
      }

      const res = await fetch(base + '/instance/fetchInstances', {
        headers: { apikey: key }
      });

      const data = await res.json();
      instancesEl.innerHTML = '';

      data.forEach(i => {
        const opt = document.createElement('option');
        opt.textContent =
          `${i.name} | status=${i.connectionStatus} | websocket=${i.Websocket?.enabled ? 'on' : 'off'}`;
        instancesEl.appendChild(opt);
      });

      log(`Loaded ${data.length} instances`);
    }

    /* ===============================
       GLOBAL WEBSOCKET CONNECTION
       =============================== */
    function connectGlobal() {
      if (socket?.connected) {
        log('âš  Already connected');
        return;
      }

      const base = document.getElementById('base').value.replace(/\/$/, '');
      const wsUrl = base.replace('https', 'wss');

      log(`Connecting to GLOBAL WS â†’ ${wsUrl}`);

      socket = io(wsUrl, {
        transports: ['websocket'],
        upgrade: false,
        reconnection: true,
        reconnectionDelay: 1000,
        reconnectionAttempts: Infinity
      });

      socket.on('connect', () => {
        log('âœ… GLOBAL WS CONNECTED');
      });

      socket.on('disconnect', reason => {
        log(`âŒ WS DISCONNECTED: ${reason}`);
      });

      socket.on('connect_error', err => {
        log(`âŒ WS ERROR: ${err.message}`);
      });

      /* ===============================
         RECEIVE ALL EVENTS
         =============================== */
      socket.onAny((event, payload) => {
        const instance =
          payload?.instance ||
          payload?.instanceName ||
          payload?.data?.instance ||
          'unknown';

        log(`ðŸ“¡ EVENT: ${event} | INSTANCE: ${instance}`);
      });

      /* ===============================
         ENGINE.IO DEBUG (OPTIONAL)
         =============================== */
      const engine = socket.io.engine;

      engine.on('open', () =>
        log(`ENGINE open (transport=${engine.transport.name})`)
      );
      engine.on('close', r =>
        log(`ENGINE close: ${r}`)
      );
    }
  </script>

</body>

</html>

<!-- 429683C4C977415CAAF0567077659866 -->